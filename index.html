<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Synonym Mind Map Generator – POS-Corrected</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 0;
      min-height: 100vh;
    }
    .container {
      max-width: 1000px;
      margin: 20px auto;
      background: rgba(255,255,255,0.97);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.08);
      padding: 32px 22px 42px 22px;
      min-height: calc(100vh - 40px);
      box-sizing: border-box;
    }
    h1 {
      text-align: center;
      background: linear-gradient(135deg, #667eea, #764ba2);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      margin-bottom: 18px;
      font-size: 2.2rem;
      font-weight: 700;
      letter-spacing: -0.5px;
    }
    .inputRow {
      display: flex; justify-content: center; gap: 12px; margin-bottom: 28px; flex-wrap: wrap; align-items: center;
    }
    #posSelect {
      padding: 12px 17px; border-radius: 11px; border: 2px solid #e1e8f0; font-size: 1.05rem; background: #fcfcff;
      outline: none; margin-right: 0;
      transition: border-color .3s;
    }
    #posSelect:focus { border-color: #764ba2; }
    #wordInput { padding: 13px 16px; font-size: 1.08rem; min-width: 180px; border-radius: 10px; border: 2px solid #e1e8f0; }
    #wordInput:focus { border-color: #667eea; }
    .btn { color:white; font-weight:600; padding:13px 30px; border:none; border-radius:10px; font-size:1.08rem; cursor:pointer;}
    #generateBtn { background: linear-gradient(135deg, #667eea, #764ba2);}
    #clearBtn { background: linear-gradient(135deg, #f093fb, #f5576c);}
    .pagination-controls { text-align:center; margin:18px 0; display:none;}
    .page-btn { background: linear-gradient(135deg, #43e97b, #38f9d7); color:white; border:none; padding:8px 16px; margin:0 5px; border-radius:7px; cursor:pointer; font-weight:600;}
    .page-btn.active { background: linear-gradient(135deg, #ffd89b, #19547b);}
    .page-info { display:inline-block; margin:0 12px; color:#666; font-weight:600;}
    #mindMapArea { position:relative; width:100%; min-height:600px; margin:0 auto; margin-top:10px; border-radius:15px;
      background: radial-gradient(circle at center, rgba(255,255,255,0.85) 0%, rgba(255,255,255,0.4) 100%);
      overflow:hidden; }
    .center-word { position:absolute; top:50%; left:50%; background:linear-gradient(135deg,#ffd89b,#19547b); color:white;
      font-weight:bold; border-radius:50px; box-shadow:0 8px 28px rgba(255,216,155,0.25); font-size:1.25rem; padding:17px 28px;
      transform:translate(-50%,-50%); text-align:center; z-index:8;}
    .synonym-node { position:absolute; width:265px; background:rgba(255,255,255,0.95); border-radius:16px;
      border:1px solid rgba(255,255,255,0.2); box-shadow:0 7px 27px rgba(0,0,0,0.10); padding:15px; text-align:center; z-index:7;}
    .synonym-label { display:inline-block; font-weight:700; border-radius:10px; padding:8px 16px; margin-bottom:4px; font-size:1.04rem; color:white;}
    .pos-badge {
      display:inline-block; margin-left:7px; padding:2px 8px;
      background: #f1eefa; color:#79539a;
      border-radius:7px; font-weight:600; font-size:0.93em; vertical-align:middle;
      box-shadow:0 2px 7px rgba(120,90,185,0.06);
    }
    .example { font-size:0.93rem; margin-top:7px; color:#4a5568; padding:7px 8px; border-radius:7px; background:rgba(255,255,255,0.7);
      min-height:30px; line-height:1.34em; text-align:left; border-left:3px solid; max-height:70px; overflow-y:auto;}
    .example-source { font-size:0.75rem; color:#666; margin-top:4px; font-weight:500;}
    svg { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; z-index:4;}
    .connection-line {stroke-width:2; stroke-linecap:round; opacity:0.54;}
    .stats { text-align:center; margin-top:13px; padding:7px; background:rgba(255,255,255,0.76); border-radius:10px; font-size:0.95rem; color:#666;}
    .error-message { text-align:center; margin-top:140px; color:#e53e3e; font-size:1.05rem; padding:18px; background:rgba(255,255,255,0.88); border-radius:12px; border:2px solid #fed7d7;}
    @media (max-width:900px) {.synonym-node{width: 220px;}}
    @media (max-width:700px) {.center-word{font-size:1.03rem; padding:11px 22px;} .synonym-label{font-size:0.97rem;} }
    @media (max-width:480px) {#posSelect{font-size:0.97rem;} #wordInput{min-width:120px;} .synonym-node{width:160px; font-size:0.85em;} #mindMapArea{min-height:300px;}}
  </style>
</head>
<body>
  <div class="container">
    <h1>✨ Synonym Mind Map Generator</h1>
    <div class="inputRow">
      <select id="posSelect" title="Part of speech">
        <option value="">All types</option>
        <option value="n">Noun</option>
        <option value="v">Verb</option>
        <option value="adj">Adjective</option>
        <option value="adv">Adverb</option>
      </select>
      <input type="text" id="wordInput" placeholder="Enter a word to explore..." maxlength="32"/>
      <button id="generateBtn" class="btn">Generate Map</button>
      <button id="clearBtn" class="btn">Clear</button>
    </div>
    <div class="pagination-controls" id="paginationControls">
      <button class="page-btn" id="prevPage">← Previous</button>
      <span class="page-info" id="pageInfo">Page 1 of 1</span>
      <button class="page-btn" id="nextPage">Next →</button>
    </div>
    <div id="mindMapArea"></div>
  </div>
<script>
const colorPalette = [
  'linear-gradient(135deg, #667eea, #764ba2)',
  'linear-gradient(135deg, #f093fb, #f5576c)',
  'linear-gradient(135deg, #4facfe, #00f2fe)',
  'linear-gradient(135deg, #43e97b, #38f9d7)',
  'linear-gradient(135deg, #fa709a, #fee140)',
  'linear-gradient(135deg, #a8edea, #fed6e3)',
  'linear-gradient(135deg, #ff9a9e, #fecfef)',
  'linear-gradient(135deg, #ffecd2, #fcb69f)'
];
const borderColors = [
  '#667eea','#f5576c','#00f2fe','#38f9d7','#fee140','#fed6e3','#fecfef','#fcb69f'
];
let allSynonyms = [];
let filteredSynonyms = [];
let mainWord = '';
let currentPage = 0;
const SYNONYMS_PER_PAGE = 6;
let isGenerating = false;

// --- Event handlers ---
document.getElementById('generateBtn').addEventListener('click', generateMindMap);
document.getElementById('clearBtn').addEventListener('click', clearMap);
document.getElementById('wordInput').addEventListener('keypress', e => { if(e.key==='Enter') generateMindMap();});
document.getElementById('prevPage').addEventListener('click', ()=>changePage(-1));
document.getElementById('nextPage').addEventListener('click', ()=>changePage(1));
document.getElementById('posSelect').addEventListener('change', ()=> {
  if (allSynonyms.length) {
    currentPage = 0;
    applyPOSFilter();
    setupPagination();
    showCurrentPage();
  }
});

function clearMap(){
  document.getElementById('wordInput').value='';
  document.getElementById('mindMapArea').innerHTML='';
  document.getElementById('paginationControls').style.display='none';
  allSynonyms=[]; filteredSynonyms=[]; currentPage=0; mainWord=''; document.getElementById('wordInput').focus();
}

// --- Main ---
async function generateMindMap(){
  if(isGenerating) return;
  const word = document.getElementById('wordInput').value.trim();
  if(!word){alert('Please enter a word.');return;}
  isGenerating=true; mainWord=word;
  const btn=document.getElementById('generateBtn');
  const orig=btn.innerHTML; btn.innerHTML='<span class="loading"></span>Generating...'; btn.disabled=true;
  document.getElementById('mindMapArea').innerHTML=
  `<div style="text-align:center;margin-top:160px;color:#666;font-size:1.1rem;">
    <div class="loading" style="margin:0 auto 11px;"></div>
    Fetching synonyms for "${word}"...
   </div>`;
  try{
    let synonyms = await fetchSynonyms(word);
    synonyms = synonyms.filter((w,i,a)=>
      i===a.findIndex(({word:b})=>b.toLowerCase()===w.word.toLowerCase())
      &&w.word.toLowerCase()!==word.toLowerCase());
    allSynonyms = synonyms;
    await fetchContextualExamples(word,synonyms.slice(0,Math.min(15,synonyms.length)));
    applyPOSFilter();
    if(filteredSynonyms.length===0){
      document.getElementById('mindMapArea').innerHTML=`
        <div class="error-message"><strong>No matching synonyms found for "${word}"</strong><br>
        Try a different word or switch 'Part of speech'.</div>`;
      document.getElementById('paginationControls').style.display='none';
    }else{
      currentPage=0;
      setupPagination();
      showCurrentPage();
    }
  }catch{
     document.getElementById('mindMapArea').innerHTML=
      `<div class="error-message"><strong>Error loading synonyms</strong><br>
       Please check your internet connection and try again.</div>`;
    document.getElementById('paginationControls').style.display='none';
  }finally{ isGenerating=false;btn.innerHTML=orig; btn.disabled=false;}
}

// --- Fetching ---
async function fetchSynonyms(word){
  try{
    const res=await fetch('https://api.datamuse.com/words?rel_syn='+encodeURIComponent(word)+'&md=p');
    if(!res.ok) throw new Error('API failed');
    return await res.json();
  }catch{
    return getSampleSynonyms(word);
  }
}
async function fetchContextualExamples(mainW,syns){
  for(let i=0;i<syns.length;i++){
    const s=syns[i];
    try{
      const r=await fetch(`https://api.datamuse.com/words?rel_trg=${encodeURIComponent(s.word)}&md=d&max=1`);
      if(r.ok){
        const data=await r.json();
        if(data.length&&data[0].defs&&data[0].defs[0]){
          let definition=data[0].defs[0].replace(/^[a-z]\t/,'');
          s.contextualExample = createNaturalExample(s.word,definition);
          s.source = "Dictionary"; continue;
        }
      }
      s.contextualExample=getImprovedContextualExample(mainW,s.word); s.source="Generated";
    }catch{
      s.contextualExample=getImprovedContextualExample(mainW,s.word); s.source="Generated";
    }
    if(i<syns.length-1) await new Promise(res=>setTimeout(res,60));
  }
}

// --- POS and filtering ---
function applyPOSFilter() {
  const posTag = document.getElementById('posSelect').value;
  if (!posTag) {
    filteredSynonyms = allSynonyms;
  } else {
    filteredSynonyms = allSynonyms.filter(syn => Array.isArray(syn.tags) && syn.tags.includes(posTag));
  }
}

// --- Map visualization and controls ---
function setupPagination(){
  const totalPages=Math.ceil(filteredSynonyms.length/SYNONYMS_PER_PAGE);
  const controls=document.getElementById('paginationControls');
  controls.style.display = (totalPages>1)?'block':'none';
  updatePaginationInfo();
}
function updatePaginationInfo(){
  const totalPages=Math.ceil(filteredSynonyms.length/SYNONYMS_PER_PAGE);
  document.getElementById('pageInfo').textContent=`Page ${totalPages ? (currentPage+1) : 0} of ${totalPages}`;
  document.getElementById('prevPage').disabled = currentPage===0;
  document.getElementById('nextPage').disabled = currentPage===totalPages-1;
}
function changePage(dir){
  const totalPages=Math.ceil(filteredSynonyms.length/SYNONYMS_PER_PAGE);
  const newPage=currentPage+dir;
  if(newPage>=0 && newPage<totalPages){
    currentPage=newPage;
    showCurrentPage();
    updatePaginationInfo();
  }
}
function showCurrentPage(){
  const start=currentPage*SYNONYMS_PER_PAGE, end=Math.min(start+SYNONYMS_PER_PAGE,filteredSynonyms.length);
  drawMindMap(mainWord,filteredSynonyms.slice(start,end));
}

// --- Map Drawing ---
function drawMindMap(mainWord,synonyms){
  const area=document.getElementById('mindMapArea'); area.innerHTML='';
  const rect=area.getBoundingClientRect();
  const w=Math.max(900,rect.width),h=Math.max(600,rect.height);
  area.style.height=h+'px';
  const cx = w/2, cy = h/2;
  const baseRad = Math.min(w * 0.46, h * 0.44);
  const yRad = baseRad * 0.94;
  // Central word
  const center=document.createElement('div');
  center.className='center-word';
  center.innerText=mainWord.charAt(0).toUpperCase()+mainWord.slice(1);
  area.appendChild(center);
  // SVG lines
  const svg=document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.setAttribute('width',w); svg.setAttribute('height',h); area.appendChild(svg);

  synonyms.forEach((synonym,i)=>{
    // Distribute with gentle oval
    const theta = (-Math.PI/2) + (i * 2*Math.PI) / synonyms.length;
    const x = cx + Math.cos(theta)*baseRad;
    const y = cy + Math.sin(theta)*yRad;
    const nodeW = 265, nodeH=88, margin=22;
    const fx = Math.max(nodeW/2+margin,Math.min(w-nodeW/2-margin,x));
    const fy = Math.max(nodeH/2+margin,Math.min(h-nodeH/2-margin,y));
    // Node
    const node=document.createElement('div');
    node.className='synonym-node';
    node.style.left=(fx-nodeW/2)+'px';
    node.style.top=(fy-nodeH/2)+'px';
    // Label + correct POS badges (could be more than 1)
    const label=document.createElement('span');
    label.className='synonym-label';
    label.style.background=colorPalette[i%colorPalette.length];
    label.innerText=synonym.word;
    // Show POS badge if available
    const posStr = getPOSBadge(synonym.tags);
    if(posStr){
      posStr.split(', ').forEach(function(pos){
        const posSpan = document.createElement('span');
        posSpan.className = 'pos-badge';
        posSpan.innerText = pos;
        label.appendChild(posSpan);
      });
    }
    node.appendChild(label);
    // Example
    const example=document.createElement('div');
    example.className='example';
    example.style.borderLeftColor=borderColors[i%borderColors.length];
    example.innerHTML=`"${synonym.contextualExample||getImprovedContextualExample(mainWord,synonym.word)}"
      <div class="example-source">${synonym.source||'Generated'}</div>`;
    node.appendChild(example);

    area.appendChild(node);
    // Line
    const line= document.createElementNS('http://www.w3.org/2000/svg','line');
    line.setAttribute('x1',cx); line.setAttribute('y1',cy);
    line.setAttribute('x2',fx); line.setAttribute('y2',fy);
    line.setAttribute('stroke',borderColors[i%borderColors.length]);
    line.className='connection-line';
    svg.appendChild(line);
  });

  const stats=document.createElement('div'); stats.className='stats';
  const total=filteredSynonyms.length,curSt=currentPage*SYNONYMS_PER_PAGE+1,curEnd=Math.min((currentPage+1)*SYNONYMS_PER_PAGE,total);
  stats.innerHTML=(total>SYNONYMS_PER_PAGE)?
        `Showing <strong>${curSt}-${curEnd}</strong> of <strong>${total}</strong> synonyms for "<strong>${mainWord}</strong>"` :
        `Found <strong>${total}</strong> synonyms for "<strong>${mainWord}</strong>"`;
  area.appendChild(stats);
}

function getPOSBadge(tags){
  if(!tags) return '';
  let badges = [];
  if(tags.includes('n')) badges.push('noun');
  if(tags.includes('v')) badges.push('verb');
  if(tags.includes('adj')) badges.push('adj');
  if(tags.includes('adv')) badges.push('adv');
  return badges.join(', ');
}

// --- Example/fallback generation ---
function createNaturalExample(word,def){
  const templates=[
    `Her ${word} plans inspired the entire team.`,
    `The ${word} approach led to great results.`,
    `The team's ${word} effort led to success.`,
    `She found a more ${word} method.`,
    `Everyone appreciated the ${word} gesture.`,
    `This task requires a ${word} attitude.`
  ];
  return templates[Math.floor(Math.random()*templates.length)];
}
function getImprovedContextualExample(mainW,syn){
  const basic=[
    `The ${syn} method proved effective in practice.`,
    `He offered their ${syn} without hesitation.`,
    `She prefers to ${syn} others succeed.`,
    `The ${syn} was well received by all.`,
    `Their ${syn} truly made a difference.`,
    `"${syn}" is another word for "${mainW}".`
  ];
  return basic[Math.floor(Math.random()*basic.length)];
}
function getSampleSynonyms(word){
  const sample={
    'happy':[{word:'joyful',tags:["adj"]},{word:'cheerful',tags:["adj"]},{word:'delighted',tags:["adj"]},{word:'elated',tags:["adj"]},{word:'content',tags:["adj"]},{word:'pleased',tags:["adj"]}],
    'help':[{word:'assist',tags:["v"]},{word:'support',tags:["v","n"]},{word:'aid',tags:["v","n"]},{word:'facilitate',tags:["v"]},{word:'avail',tags:["v"]},{word:'encourage',tags:["v"]}],
    'big':[{word:'large',tags:["adj"]},{word:'huge',tags:["adj"]},{word:'massive',tags:["adj"]},{word:'enormous',tags:["adj"]},{word:'gigantic',tags:["adj"]},{word:'vast',tags:["adj"]}],
    'good':[{word:'excellent',tags:["adj"]},{word:'wonderful',tags:["adj"]},{word:'superb',tags:["adj"]},{word:'great',tags:["adj"]},{word:'positive',tags:["adj"]},{word:'marvelous',tags:["adj"]}]
  };
  const k=word.toLowerCase();
  return sample[k]||[{word:'similar',tags:["adj"]},{word:'akin',tags:["adj"]},{word:'related',tags:["adj"]},{word:'comparable',tags:["adj"]},{word:'alike',tags:["adj"]},{word:'matching',tags:["adj"]}];
}

window.addEventListener('load',()=>{document.getElementById('wordInput').focus();});
</script>
</body>
</html>
